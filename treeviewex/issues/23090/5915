public static DependencyProperty IsSelectedProperty = DependencyProperty.Register(
	"IsSelected",
	typeof(bool),
	typeof(TreeViewExItem),
	new FrameworkPropertyMetadata(false, FrameworkPropertyMetadataOptions.None, new PropertyChangedCallback(OnIsSelectedChanged)));

protected static void OnIsSelectedChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
{
	TreeViewExItem item = d as TreeViewExItem;
	if (item != null)
	{
		if ((bool) e.NewValue)
		{
			if (!item.ParentTreeView.SelectedItems.Contains(item.DataContext))
			{
				item.ParentTreeView.SelectedItems.Add(item.DataContext);
			}
		}
		else
		{
			item.ParentTreeView.SelectedItems.Remove(item.DataContext);
		}
	}
}

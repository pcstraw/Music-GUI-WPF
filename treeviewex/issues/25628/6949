Index: TreeViewEx/Controls/VirtualizingTreePanel.cs
===================================================================
--- TreeViewEx/Controls/VirtualizingTreePanel.cs	(revision 704)
+++ TreeViewEx/Controls/VirtualizingTreePanel.cs	(working copy)
@@ -123,6 +123,13 @@
                                 // Figure out if we need to insert the child at the end or somewhere in the middle
                                 AddOrInsertItemToInternalChildren(itemGeneratorIndex, child);
                                 child.ParentTreeView = treeView;
+
+                                // Test if the item is selected (but is not in the selected items list).
+                                // If it is, throw an InvalidOperationException because we don't know the whole selection list due to virtualization
+                                if (child.IsSelected && !treeView.SelectedItems.Contains(child.DataContext)) {
+                                    throw new InvalidOperationException("Items must not be selected when virtualizing");
+                                }
+
                                 generator.PrepareItemContainer(child);
                             }
                             else
@@ -202,7 +209,13 @@
                         {
                             // Figure out if we need to insert the child at the end or somewhere in the middle
                             AddOrInsertItemToInternalChildren(i, child);
-                            child.ParentTreeView = treeView ?? treeViewItem.ParentTreeView;
+                            child.ParentTreeView = treeView;
+
+                            // Adds selected items to the SelectedItems list
+                            if (child.IsSelected) {
+                                treeView.SelectedItems.Add(child.DataContext);
+                            }
+
                             generator.PrepareItemContainer(child);
                         }
 
